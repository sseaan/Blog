---
import config, { monolocale } from "$config";
import Base from "$layouts/Base.astro";
import Icon from "$components/Icon.astro";
import i18nit from "$i18n";
import Giscus from "$components/Giscus.svelte";
import { friendlinks } from "../../content/friendlinks.ts";

export async function getStaticPaths() {
	// Create path for each locale, omitting default locale from URL
	return config.i18n.locales.map(locale => ({ params: { locale: config.i18n.defaultLocale === locale ? undefined : locale } }));
}

const { locale = config.i18n.defaultLocale } = Astro.params;
const t = i18nit(locale);
---

<style lang="less">
	.friendlinks-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
		gap: 1.5rem;
		margin-top: 1.5rem;

		.friendlink-card {
			display: flex;
			flex-direction: column;
			gap: 1rem;
			padding: 1.5rem;
			border: none;
			border-radius: 1rem;
			background: rgba(255, 255, 255, 0.5);
			backdrop-filter: blur(20px) saturate(180%);
			-webkit-backdrop-filter: blur(20px) saturate(180%);
			border: 2px solid rgba(255, 255, 255, 0.8);
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
			transition: all 0.3s ease;

			&:hover {
				background: rgba(255, 255, 255, 0.65);
				border-color: rgba(255, 255, 255, 1);
				box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
				transform: translateY(-4px);
			}

			@media (prefers-color-scheme: dark) {
				background: rgba(255, 255, 255, 0.1);
				border: 1px solid rgba(255, 255, 255, 0.2);
				backdrop-filter: blur(20px) saturate(180%);
				-webkit-backdrop-filter: blur(20px) saturate(180%);

				&:hover {
					background: rgba(255, 255, 255, 0.15);
					border-color: rgba(255, 255, 255, 0.3);
				}
			}

			[data-theme="dark"] & {
				background: rgba(255, 255, 255, 0.1);
				border: 1px solid rgba(255, 255, 255, 0.2);
				backdrop-filter: blur(20px) saturate(180%);
				-webkit-backdrop-filter: blur(20px) saturate(180%);

				&:hover {
					background: rgba(255, 255, 255, 0.15);
					border-color: rgba(255, 255, 255, 0.3);
				}
			}

			[data-theme="light"] & {
				background: rgba(255, 255, 255, 0.5);
				border: 2px solid rgba(255, 255, 255, 0.8);
				backdrop-filter: blur(20px) saturate(180%);
				-webkit-backdrop-filter: blur(20px) saturate(180%);
				box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);

				&:hover {
					background: rgba(255, 255, 255, 0.65);
					border-color: rgba(255, 255, 255, 1);
					box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
				}
			}

			.header {
				display: flex;
				align-items: center;
				gap: 1rem;

				.avatar {
					width: 48px;
					height: 48px;
					border-radius: 50%;
					object-fit: cover;
					border: 2px solid rgba(255, 255, 255, 0.2);
					flex-shrink: 0;
				}

				.info {
					flex: 1;
					display: flex;
					flex-direction: column;
					gap: 0.25rem;

					.name {
						font-weight: bold;
						font-size: 1rem;
						color: var(--primary-color);
					}

					.url {
						font-size: 0.75rem;
						color: var(--weak-color);
						white-space: nowrap;
						overflow: hidden;
						text-overflow: ellipsis;
					}
				}
			}

			.description {
				flex: 1;
				font-size: 0.9rem;
				color: var(--remark-color);
				line-height: 1.5;
				display: -webkit-box;
				-webkit-line-clamp: 3;
				-webkit-box-orient: vertical;
				overflow: hidden;
			}

			.link {
				display: inline-flex;
				align-items: center;
				gap: 0.5rem;
				padding: 0.5rem 1rem;
				background: rgba(255, 255, 255, 0.4);
				backdrop-filter: blur(15px) saturate(150%);
				-webkit-backdrop-filter: blur(15px) saturate(150%);
				border-radius: 0.5rem;
				border: 1px solid rgba(255, 255, 255, 0.5);
				color: var(--primary-color);
				font-size: 0.9rem;
				font-weight: 600;
				transition: all 0.2s ease;
				align-self: flex-start;

				&:hover {
					background: rgba(255, 255, 255, 0.6);
					border-color: rgba(255, 255, 255, 0.7);
				}

				@media (prefers-color-scheme: dark) {
					background: rgba(255, 255, 255, 0.2);
					border: 1px solid rgba(255, 255, 255, 0.2);

					&:hover {
						background: rgba(255, 255, 255, 0.3);
						border-color: rgba(255, 255, 255, 0.4);
					}
				}

				[data-theme="dark"] & {
					background: rgba(255, 255, 255, 0.2);
					border: 1px solid rgba(255, 255, 255, 0.2);
					backdrop-filter: blur(15px) saturate(150%);
					-webkit-backdrop-filter: blur(15px) saturate(150%);

					&:hover {
						background: rgba(255, 255, 255, 0.3);
						border-color: rgba(255, 255, 255, 0.4);
					}
				}

				[data-theme="light"] & {
					background: rgba(255, 255, 255, 0.4);
					border: 2px solid rgba(255, 255, 255, 0.7);
					backdrop-filter: blur(15px) saturate(150%);
					-webkit-backdrop-filter: blur(15px) saturate(150%);

					&:hover {
						background: rgba(255, 255, 255, 0.6);
						border-color: rgba(255, 255, 255, 1);
					}
				}
			}
		}
	}

	.empty-state {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		gap: 1rem;
		padding: 3rem;
		text-align: center;

		svg {
			width: 64px;
			height: 64px;
			color: var(--weak-color);
		}

		p {
			color: var(--remark-color);
		}
	}
</style>

<Base title={t("navigation.friendlink")} {locale} description={t("friendlink.description")}>
	<main class="flex flex-col gap-6">
		<header class="flex flex-col gap-4">
			<h1 class="text-3xl">{t("navigation.friendlink")}</h1>
			<p class="text-lg c-remark">{t("friendlink.description")}</p>
			<hr class="b-b b-b-solid b-weak" />
		</header>

		{
			friendlinks.length > 0 ? (
				<div class="friendlinks-grid">
					{friendlinks.map((link: any) => (
						<div class="friendlink-card">
							<div class="header">
								{link.avatar && <img src={link.avatar} alt={link.name} class="avatar" />}
								<div class="info">
									<div class="name">{link.name}</div>
									<div class="url">{new URL(link.url).hostname}</div>
								</div>
							</div>
							<div class="description">{link.description}</div>
							<a href={link.url} target="_blank" rel="noopener noreferrer" class="link">
								访问网站 →
							</a>
						</div>
					))}
				</div>
			) : (
				<div class="empty-state">
					<Icon name="lucide:link-2-off" />
					<p>{t("friendlink.empty")}</p>
				</div>
			)
		}

		<hr class="b-b b-b-solid b-weak my-4" />
		
		<Giscus 
			client:load
			repo="Yaten-Z/blog-giscus"
			repoId="R_kgDOOzg2eg"
			category="Announcements"
			categoryId="DIC_kwDOOzg2es4Cq1Mo"
			lang="zh-CN"
			lightTheme="noborder_light"
			darkTheme="noborder_dark"
		/>
	</main>
</Base>
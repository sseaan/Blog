---
title: 在 Astro ThoughtLite 中添加 Giscus 评论系统
timestamp: 2025-12-04 07:00:00+00:00
series: Blog
tags: [Blog, Astro]
description: 在 Blog 添加 Giscus 评论系统
toc: true
---

# 前言

首先，先原谅我最近太忙了，没啥时间写Blog。  
先是期中考试，然后是家长会，接着又要和高中联考数学和物理，这中间还一直在忙青科创。  
这个 Giscus 评论系统其实早在 2025.11.11 的时候就被我添加了，  
但是现在才想起来有这个东西没和大家讲。

如果你正在使用 Astro ThoughtLite ，你可能会发现缺少一个好的评论系统。  
Giscus 是一个基于 GitHub Discussions 的评论系统，  
它轻量级、易于集成，且完全免费。  
本文将指导你如何在 Astro ThoughtLite 中优雅地集成 Giscus。

# Giscus 是什么？

Giscus 是一个由评论驱动的评论系统，利用 GitHub Discussions API 来存储和管理网站评论。相比传统的评论系统，它有几个显著优势：

- **免费且开源** - 无需付费服务，代码公开可审计
- **基于 GitHub** - 评论与你的 GitHub 仓库深度集成
- **无广告** - 完全干净的用户体验
- **支持多种主题** - 可适配浅色和深色界面
- **响应式设计** - 在任何设备上都能良好显示
- **支持多语言** - 内置多语言支持

# 前置准备

在开始之前，你需要：

1. **一个 GitHub 仓库** - 用来存储评论数据的公开仓库
2. **启用 Discussions** - 在仓库设置中启用 GitHub Discussions 功能
3. **Giscus App 授权** - 在 [giscus.app](https://giscus.app) 授权应用访问你的仓库

# 设置 Giscus

访问 [giscus.app](https://giscus.app)，按照以下步骤配置：

## 1. 授权仓库

在页面的 **Configuration** 部分，输入你的仓库地址（格式：`username/repo`）。Giscus 会自动获取 `repoId` 和其他必要的配置信息。

## 2. 配置 Discussions

选择一个讨论分类来存储评论。推荐使用 **"Announcements"** 或专门为评论创建的分类。记下分类的 `categoryId`。

## 3. 其他选项

- **映射方式** - 选择 `pathname`（按路由映射，推荐）
- **严格模式** - 建议启用，确保每个页面只有一个讨论
- **反应表情** - 启用用户可添加反应表情
- **输入框位置** - 选择 `top` 或 `bottom`

完成配置后，Giscus 会在页面下方显示你需要的配置代码。

# 创建 Svelte 组件

在 Astro 项目中创建 `src/components/Giscus.svelte`：

```svelte
<script lang="ts">
import { onMount } from "svelte";

interface Props {
	repo: string;
	repoId: string;
	category: string;
	categoryId: string;
	mapping?: "pathname" | "url" | "title" | "og:title" | "number" | "specific";
	term?: string;
	strict?: boolean;
	reactions?: boolean;
	inputPosition?: "top" | "bottom";
	lightTheme?: string;
	darkTheme?: string;
	lang?: string;
}

let {
	repo,
	repoId,
	category,
	categoryId,
	mapping = "pathname",
	term,
	strict = true,
	reactions = true,
	inputPosition = "top",
	lightTheme = "light",
	darkTheme = "dark",
	lang = "zh-CN"
}: Props = $props();

let giscusContainer: HTMLDivElement | undefined = $state();

const sendMessage = (message: any) => {
	const iframe = document.querySelector("iframe.giscus-frame") as HTMLIFrameElement;
	if (!iframe) return;
	iframe.contentWindow?.postMessage({ giscus: message }, "https://giscus.app");
};

const getCurrentTheme = (): string => {
	const isDark = document.documentElement.dataset.theme === "dark";
	return isDark ? darkTheme : lightTheme;
};

const handleThemeChange = () => {
	const currentTheme = getCurrentTheme();
	sendMessage({ setConfig: { theme: currentTheme } });
};

onMount(() => {
	if (!giscusContainer) return;

	const script = document.createElement("script");
	script.src = "https://giscus.app/client.js";
	script.async = true;
	script.crossOrigin = "anonymous";

	const initialTheme = getCurrentTheme();
	script.setAttribute("data-repo", repo);
	script.setAttribute("data-repo-id", repoId);
	script.setAttribute("data-category", category);
	script.setAttribute("data-category-id", categoryId);
	script.setAttribute("data-mapping", mapping);
	if (term) script.setAttribute("data-term", term);
	script.setAttribute("data-strict", String(strict));
	script.setAttribute("data-reactions-enabled", String(reactions));
	script.setAttribute("data-emit-metadata", "0");
	script.setAttribute("data-input-position", inputPosition);
	script.setAttribute("data-theme", initialTheme);
	script.setAttribute("data-lang", lang);

	giscusContainer.appendChild(script);

	// 监听主题变化
	const observer = new MutationObserver(() => {
		handleThemeChange();
	});

	observer.observe(document.documentElement, { 
		attributes: true, 
		attributeFilter: ["data-theme"] 
	});

	return () => observer.disconnect();
});
</script>

<div bind:this={giscusContainer} class="giscus-container"></div>

<style>
	:global(.giscus-container) {
		margin-top: 2rem;
	}

	:global(.giscus) {
		color-scheme: light dark;
	}
</style>
```

# 在文章中使用

在你的文章模板（`src/pages/[...locale]/note/[...id].astro`）和  
随笔模板（`src/pages/[...locale]/jotting/[...id].astro`）中添加 Giscus 组件：

```astro
---
import Giscus from "$components/Giscus.svelte";
---

<main>
	<!-- 文章内容 -->
	<article class="markdown">
		<Content />
	</article>

	<!-- 添加 Giscus 评论系统 -->
	<Giscus 
		client:load
		repo="your-username/your-repo"
		repoId="Your repo-id"
		category="Your category"
		categoryId="Your categoryId"
		lightTheme="noborder_light"
		darkTheme="noborder_dark"
		lang="zh-CN"
	/>
</main>
```

## 配置选项详解

| 参数 | 类型 | 必需 | 说明 |
|------|------|------|------|
| `repo` | string | ✓ | 仓库地址，格式：`username/repo` |
| `repoId` | string | ✓ | 仓库 ID，从 Giscus 配置获取 |
| `category` | string | ✓ | Discussions 分类名称 |
| `categoryId` | string | ✓ | 分类 ID，从 Giscus 配置获取 |
| `mapping` | string | ✗ | 映射方式，默认 `pathname` |
| `lightTheme` | string | ✗ | 浅色主题，默认 `light` |
| `darkTheme` | string | ✗ | 深色主题，默认 `dark` |
| `lang` | string | ✗ | 语言代码，默认 `zh-CN` |
| `inputPosition` | string | ✗ | 输入框位置，默认 `top` |
| `reactions` | boolean | ✗ | 是否启用反应表情，默认 `true` |
| `strict` | boolean | ✗ | 是否启用严格模式，默认 `true` |

## 主题选项

Giscus 支持多种主题。推荐的搭配：

```svelte
<!-- 边框浅色/深色 -->
<Giscus 
	lightTheme="noborder_light"
	darkTheme="noborder_dark"
/>

<!-- GitHub 官方主题 -->
<Giscus 
	lightTheme="light"
	darkTheme="dark"
/>

<!-- 高对比度 -->
<Giscus 
	lightTheme="light_high_contrast"
	darkTheme="dark_high_contrast"
/>
```

## 自动主题切换

组件已内置主题切换逻辑。当用户在网站上切换浅色/深色模式时，评论区会自动切换对应主题。

这是通过监听 `document.documentElement.dataset.theme` 属性实现的。确保你的网站主题切换时更新这个属性：

```javascript
function turnDark(on: boolean) {
	const theme = on ? "dark" : "light";
	document.documentElement.dataset.theme = theme;
	localStorage.setItem("theme", theme);
}
```

# 常见问题

**Q: 为什么看不到评论？**  
A: 确保你的仓库是公开的，且已启用 Discussions。同时检查 Giscus App 是否有访问权限。

**Q: 如何修改已发布的评论？**  
A: 评论存储在 GitHub Discussions 中，可以直接在 GitHub 仓库的 Discussions 标签页编辑。

**Q: 可以禁用某些页面的评论吗？**  
A: 可以。在模板中添加条件判断，只在特定页面渲染 Giscus 组件。

**Q: Giscus 支持垃圾评论过滤吗？**  
A: Giscus 依赖 GitHub 的内容政策。恶意评论可以直接在 GitHub Discussions 中删除或锁定。

# 总结

Giscus 是为 Astro 博客添加评论功能的绝佳选择。它轻量级、易于集成，且与 GitHub 深度融合。通过上述步骤，你可以快速为你的博客增添用户互动的新维度。

更多信息，访问 [Giscus 官方文档](https://giscus.app)。

欢迎大家在评论区评论！